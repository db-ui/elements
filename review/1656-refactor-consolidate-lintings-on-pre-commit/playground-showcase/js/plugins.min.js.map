{"version":3,"file":"plugins.min.js","names":["registerFocusRestoreDialog","window","WeakMap","MutationObserver","registered","previousFocus","document","addEventListener","ev","target","dialog","localName","Error","has","set","realShowModal","showModal","savedFocus","activeElement","body","call","mo","hasAttribute","observe","attributes","attributeFilter","get","contains","wasFocus","focus"],"sources":["../_patterns/02-components/dialog/focus-restore.dialog.plugin.js"],"sourcesContent":["// from: https://gist.github.com/samthor/babe9fad4a65625b301ba482dad284d1\n/**\n * Updates the passed dialog to retain focus and restore it when the dialog is closed. Won't\n * upgrade a dialog more than once. Supports IE11+ and is a no-op otherwise.\n * @param {!HTMLDialogElement} dialog to upgrade\n */\nvar registerFocusRestoreDialog = (function() {\n  if (!window.WeakMap || !window.MutationObserver) {\n    return function() {};\n  }\n  var registered = new WeakMap();\n\n  // store previous focused node centrally\n  var previousFocus = null;\n  document.addEventListener('focusout', function(ev) {\n    previousFocus = ev.target;\n  }, true);\n\n  return function registerFocusRestoreDialog(dialog) {\n    if (dialog.localName !== 'dialog') {\n      throw new Error('Failed to upgrade focus on dialog: The element is not a dialog.');\n    }\n    if (registered.has(dialog)) { return; }\n    registered.set(dialog, null);\n\n    // replace showModal method directly, to save focus\n    var realShowModal = dialog.showModal;\n    dialog.showModal = function() {\n      var savedFocus = document.activeElement;\n      if (savedFocus === document || savedFocus === document.body) {\n        // some browsers read activeElement as body\n        savedFocus = previousFocus;\n      }\n      registered.set(dialog, savedFocus);\n      realShowModal.call(this);\n    };\n\n    // watch for 'open' change and clear saved\n    var mo = new MutationObserver(function() {\n      if (!dialog.hasAttribute('open')) {\n        registered.set(dialog, null);\n      } else {\n        // if open was cleared/set in the same frame, then the dialog will still be a modal (Y)\n      }\n    });\n    mo.observe(dialog, {attributes: true, attributeFilter: ['open']});\n\n    // on close, try to focus saved, if possible\n    dialog.addEventListener('close', function(ev) {\n      if (dialog.hasAttribute('open')) {\n        return;  // in native, this fires the frame later\n      }\n      var savedFocus = registered.get(dialog);\n      if (document.contains(savedFocus)) {\n        var wasFocus = document.activeElement;\n        savedFocus.focus();\n        if (document.activeElement !== savedFocus) {\n          wasFocus.focus();  // restore focus, we couldn't focus saved\n        }\n      }\n      savedFocus = null;\n    });\n\n    // FIXME: If a modal dialog is readded to the page (either remove/add or .appendChild), it will\n    // be a non-modal. It will still have its 'close' handler called and try to focus on the saved\n    // element.\n    //\n    // These could basically be solved if 'close' yielded whether it was a modal or non-modal\n    // being closed. But it doesn't. It could also be solved by a permanent MutationObserver, as is\n    // done inside the polyfill.\n  }\n}());\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,GACA,GAAI,CAAAA,0BAA0B,CAAI,UAAW,CAC3C,GAAI,CAACC,MAAM,CAACC,OAAO,EAAI,CAACD,MAAM,CAACE,gBAAgB,CAAE,CAC/C,MAAO,WAAW,CAAC,CACrB,CACA,GAAI,CAAAC,UAAU,CAAG,GAAI,CAAAF,OAAS,CAE9B;AACA,GAAI,CAAAG,aAAa,CAAG,IAAI,CACxBC,QAAQ,CAACC,gBAAgB,CAAC,UAAU,CAAE,SAASC,EAAE,CAAE,CACjDH,aAAa,CAAGG,EAAE,CAACC,MACrB,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,SAAS,CAAAT,0BAA0BA,CAACU,MAAM,CAAE,CACjD,GAAIA,MAAM,CAACC,SAAS,GAAK,QAAQ,CAAE,CACjC,KAAM,IAAI,CAAAC,KAAK,CAAC,iEAAiE,CACnF,CACA,GAAIR,UAAU,CAACS,GAAG,CAACH,MAAM,CAAC,CAAE,CAAE,MAAQ,CACtCN,UAAU,CAACU,GAAG,CAACJ,MAAM,CAAE,IAAI,CAAC,CAE5B;AACA,GAAI,CAAAK,aAAa,CAAGL,MAAM,CAACM,SAAS,CACpCN,MAAM,CAACM,SAAS,CAAG,UAAW,CAC5B,GAAI,CAAAC,UAAU,CAAGX,QAAQ,CAACY,aAAa,CACvC,GAAID,UAAU,GAAKX,QAAQ,EAAIW,UAAU,GAAKX,QAAQ,CAACa,IAAI,CAAE,CAC3D;AACAF,UAAU,CAAGZ,aACf,CACAD,UAAU,CAACU,GAAG,CAACJ,MAAM,CAAEO,UAAU,CAAC,CAClCF,aAAa,CAACK,IAAI,CAAC,IAAI,CACzB,CAAC,CAED;AACA,GAAI,CAAAC,EAAE,CAAG,GAAI,CAAAlB,gBAAgB,CAAC,UAAW,CACvC,GAAI,CAACO,MAAM,CAACY,YAAY,CAAC,MAAM,CAAC,CAAE,CAChClB,UAAU,CAACU,GAAG,CAACJ,MAAM,CAAE,IAAI,CAC7B,CAAC,IAAM,CACL;AAAA,CAEJ,CAAC,CAAC,CACFW,EAAE,CAACE,OAAO,CAACb,MAAM,CAAE,CAACc,UAAU,CAAE,IAAI,CAAEC,eAAe,CAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAEjE;AACAf,MAAM,CAACH,gBAAgB,CAAC,OAAO,CAAE,SAASC,EAAE,CAAE,CAC5C,GAAIE,MAAM,CAACY,YAAY,CAAC,MAAM,CAAC,CAAE,CAC/B,OAAS;AACX,CACA,GAAI,CAAAL,UAAU,CAAGb,UAAU,CAACsB,GAAG,CAAChB,MAAM,CAAC,CACvC,GAAIJ,QAAQ,CAACqB,QAAQ,CAACV,UAAU,CAAC,CAAE,CACjC,GAAI,CAAAW,QAAQ,CAAGtB,QAAQ,CAACY,aAAa,CACrCD,UAAU,CAACY,KAAK,CAAC,CAAC,CAClB,GAAIvB,QAAQ,CAACY,aAAa,GAAKD,UAAU,CAAE,CACzCW,QAAQ,CAACC,KAAK,CAAC,CAAC,CAAG;AACrB,CACF,CACAZ,UAAU,CAAG,IACf,CAAC,CAAC,CAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACF,CACF,CAAC,CAAC,CAAE"}