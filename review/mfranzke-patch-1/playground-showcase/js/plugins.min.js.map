{"version":3,"file":"plugins.min.js","names":["registerFocusRestoreDialog","window","WeakMap","MutationObserver","registered","previousFocus","document","addEventListener","ev","target","dialog","localName","Error","has","set","realShowModal","showModal","savedFocus","activeElement","body","call","mo","hasAttribute","observe","attributes","attributeFilter","get","contains","wasFocus","focus"],"sources":["../_patterns/02-components/dialog/focus-restore.dialog.plugin.js"],"sourcesContent":["// from: https://gist.github.com/samthor/babe9fad4a65625b301ba482dad284d1\n/**\n * Updates the passed dialog to retain focus and restore it when the dialog is closed. Won't\n * upgrade a dialog more than once. Supports IE11+ and is a no-op otherwise.\n * @param {!HTMLDialogElement} dialog to upgrade\n */\nvar registerFocusRestoreDialog = (function() {\n  if (!window.WeakMap || !window.MutationObserver) {\n    return function() {};\n  }\n  var registered = new WeakMap();\n\n  // store previous focused node centrally\n  var previousFocus = null;\n  document.addEventListener('focusout', function(ev) {\n    previousFocus = ev.target;\n  }, true);\n\n  return function registerFocusRestoreDialog(dialog) {\n    if (dialog.localName !== 'dialog') {\n      throw new Error('Failed to upgrade focus on dialog: The element is not a dialog.');\n    }\n    if (registered.has(dialog)) { return; }\n    registered.set(dialog, null);\n\n    // replace showModal method directly, to save focus\n    var realShowModal = dialog.showModal;\n    dialog.showModal = function() {\n      var savedFocus = document.activeElement;\n      if (savedFocus === document || savedFocus === document.body) {\n        // some browsers read activeElement as body\n        savedFocus = previousFocus;\n      }\n      registered.set(dialog, savedFocus);\n      realShowModal.call(this);\n    };\n\n    // watch for 'open' change and clear saved\n    var mo = new MutationObserver(function() {\n      if (!dialog.hasAttribute('open')) {\n        registered.set(dialog, null);\n      } else {\n        // if open was cleared/set in the same frame, then the dialog will still be a modal (Y)\n      }\n    });\n    mo.observe(dialog, {attributes: true, attributeFilter: ['open']});\n\n    // on close, try to focus saved, if possible\n    dialog.addEventListener('close', function(ev) {\n      if (dialog.hasAttribute('open')) {\n        return;  // in native, this fires the frame later\n      }\n      var savedFocus = registered.get(dialog);\n      if (document.contains(savedFocus)) {\n        var wasFocus = document.activeElement;\n        savedFocus.focus();\n        if (document.activeElement !== savedFocus) {\n          wasFocus.focus();  // restore focus, we couldn't focus saved\n        }\n      }\n      savedFocus = null;\n    });\n\n    // FIXME: If a modal dialog is readded to the page (either remove/add or .appendChild), it will\n    // be a non-modal. It will still have its 'close' handler called and try to focus on the saved\n    // element.\n    //\n    // These could basically be solved if 'close' yielded whether it was a modal or non-modal\n    // being closed. But it doesn't. It could also be solved by a permanent MutationObserver, as is\n    // done inside the polyfill.\n  }\n}());\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,GACA,GAAIA,2BAA0B,CAAI,UAAW,CAC3C,GAAI,CAACC,MAAM,CAACC,OAAR,EAAmB,CAACD,MAAM,CAACE,gBAA/B,CAAiD,CAC/C,MAAO,WAAW,CAAE,CACrB,CACD,GAAIC,WAAU,CAAG,GAAIF,QAArB,CAEA;AACA,GAAIG,cAAa,CAAG,IAApB,CACAC,QAAQ,CAACC,gBAAT,CAA0B,UAA1B,CAAsC,SAASC,EAAT,CAAa,CACjDH,aAAa,CAAGG,EAAE,CAACC,MACpB,CAFD,CAEG,IAFH,EAIA,MAAO,SAAST,2BAAT,CAAoCU,MAApC,CAA4C,CACjD,GAAIA,MAAM,CAACC,SAAP,GAAqB,QAAzB,CAAmC,CACjC,KAAM,IAAIC,MAAJ,CAAU,iEAAV,CACP,CACD,GAAIR,UAAU,CAACS,GAAX,CAAeH,MAAf,CAAJ,CAA4B,CAAE,MAAS,CACvCN,UAAU,CAACU,GAAX,CAAeJ,MAAf,CAAuB,IAAvB,EAEA;AACA,GAAIK,cAAa,CAAGL,MAAM,CAACM,SAA3B,CACAN,MAAM,CAACM,SAAP,CAAmB,UAAW,CAC5B,GAAIC,WAAU,CAAGX,QAAQ,CAACY,aAA1B,CACA,GAAID,UAAU,GAAKX,QAAf,EAA2BW,UAAU,GAAKX,QAAQ,CAACa,IAAvD,CAA6D,CAC3D;AACAF,UAAU,CAAGZ,aACd,CACDD,UAAU,CAACU,GAAX,CAAeJ,MAAf,CAAuBO,UAAvB,EACAF,aAAa,CAACK,IAAd,CAAmB,IAAnB,CACD,CARD,CAUA;AACA,GAAIC,GAAE,CAAG,GAAIlB,iBAAJ,CAAqB,UAAW,CACvC,GAAI,CAACO,MAAM,CAACY,YAAP,CAAoB,MAApB,CAAL,CAAkC,CAChClB,UAAU,CAACU,GAAX,CAAeJ,MAAf,CAAuB,IAAvB,CACD,CAFD,IAEO,CACL;AACD,CACF,CANQ,CAAT,CAOAW,EAAE,CAACE,OAAH,CAAWb,MAAX,CAAmB,CAACc,UAAU,CAAE,IAAb,CAAmBC,eAAe,CAAE,CAAC,MAAD,CAApC,CAAnB,EAEA;AACAf,MAAM,CAACH,gBAAP,CAAwB,OAAxB,CAAiC,SAASC,EAAT,CAAa,CAC5C,GAAIE,MAAM,CAACY,YAAP,CAAoB,MAApB,CAAJ,CAAiC,CAC/B,OAAS;AACV,CACD,GAAIL,WAAU,CAAGb,UAAU,CAACsB,GAAX,CAAehB,MAAf,CAAjB,CACA,GAAIJ,QAAQ,CAACqB,QAAT,CAAkBV,UAAlB,CAAJ,CAAmC,CACjC,GAAIW,SAAQ,CAAGtB,QAAQ,CAACY,aAAxB,CACAD,UAAU,CAACY,KAAX,GACA,GAAIvB,QAAQ,CAACY,aAAT,GAA2BD,UAA/B,CAA2C,CACzCW,QAAQ,CAACC,KAAT,GAAmB;AACpB,CACF,CACDZ,UAAU,CAAG,IACd,CAbD,EAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,CACF,CAjEiC,EAAlC"}