name: Build Showcases

on:
  workflow_call:

jobs:
  build-showcases:
    name: Build Showcases
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        showcases: [angular, playground, react, reactwind, vue]
    steps:
      - name: â¬‡ Checkout repo
        uses: actions/checkout@v3

      - name: ðŸ”„ Init Cache
        uses: ./.github/actions/npm-cache

      - name: â†” Get download params for showcase
        run: |
          if echo ${{ matrix.targets }} | grep -c "angular"
          then
            echo '::set-output name=framework::angular'
          elif echo ${{ matrix.targets }} | grep -c "playground"
          then
            echo '::set-output name=framework::react'
          elif echo ${{ matrix.targets }} | grep -c "react"
          then
            echo '::set-output name=framework::react'
          elif echo ${{ matrix.targets }} | grep -c "reactwind"
          then
            echo '::set-output name=framework::react'
          else
            echo '::set-output name=framework::vue'
          fi
          echo '::set-output name=theme::local'
        id: download-params

      - name: â¬‡ Download Stencil ${{ steps.download-params.outputs.theme }}
        uses: ./.github/actions/download-tar-artifact
        with:
          name: stencil-${{ steps.download-params.outputs.theme }}-${{ steps.download-params.outputs.framework }}
          path: packages/db-ui-elements-stencil

      - name: â¬‡ Download Output Target ${{ steps.download-params.outputs.framework }}
        uses: ./.github/actions/download-tar-artifact
        with:
          name: output-target-${{ steps.download-params.outputs.theme }}-${{ steps.download-params.outputs.framework }}
          path: packages/db-ui-elements-${{ steps.download-params.outputs.framework }}

      - name: ðŸ”¨ Build Showcase ${{ matrix.showcases }}
        run: |
          cd showcase/${{ matrix.showcases }}-showcase
          npm i
          npm run build
          npx --yes cpr showcase/${{ matrix.showcases }}-showcase/dist/${{ matrix.showcases }}-showcase/index.html showcase/${{ matrix.showcases }}-showcase/dist/${{ matrix.showcases }}-showcase/404.html

      - name: â¬† Upload Showcase ${{ matrix.showcases }} dist folder
        uses: ./.github/actions/upload-tar-artifact
        with:
          name: showcase-${{ matrix.showcases }}
          path: showcase/${{ matrix.showcases }}-showcase/dist
